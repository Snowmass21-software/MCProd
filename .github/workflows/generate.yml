name: Event Generation and Simulation
on: push
jobs:
  gen:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/kkrizka/mcprod:pr-4
    strategy:
      matrix:
        energy: [13, 100]
        process: [B, BB, BBB, tt, t, tB, ttB, LL, LLB, vbf] #, H]
    steps:
      -
        name: Checkout        
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
      -
        name: Generate GridPacks
        run: |
          python makeGridPacks.py ${{ matrix.energy }} ${{ matrix.process }} 1
          /opt/MG5aMC/3.3.1/bin/mg5_aMC < makeGridPacks.mg
          tar -xzvf ${{ matrix.energy }}TeV_${{ matrix.process }}/run_01_gridpack.tar.gz
          cd madevent
          ./bin/compile
          ./bin/clean4grid || true # Always fails due to `rm -f directory`
          ./bin/gridrun 1000 0 1
